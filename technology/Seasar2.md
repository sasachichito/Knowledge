## 前知識  
- ビルド  
jarコマンドでwarファイルを作成すること。  
【参考】https://qiita.com/Qui/items/14961678ef939673f744  
- クラスパスルート  
warファイル内の/WEB-INF/classesディレクトリ配下を指す。  
ビルド前のプロジェクトの段階では、プロジェクト名/src/main/resources配下にあるファイルが  
ビルド時にクラスパスルートに配置される設定になっていることが多い。  
  
## 環境の切り替え  
クラスパスルートにあるenv.txtを使用する。  
ut,ct,it,productのいずれかの値を記載する。使い方は2種類ある。  
- diconファイル内で使用する  
`#ENV`でアクセスし、分岐処理を書く。  
- diconファイルの切り替えで使用する
「app_ut.dicon」のように、「_環境名」のファイルを用意すると、環境名付きのdiconファイルが使用される。
- Javaコードで使用する  
`Env.getValue()`でアクセスし、分岐処理を書く。  
- SMARTデプロイの切り替え  
ENVの値によって実行モードが決定する。  
  
ビルドの段階でwarファイルに含めるenv.txtを切り替える運用方法も見られる。  
  
## SMART deploy  
Seasar2が利用している、コンテナにコンポーネントを登録するタイミングが異なる三つの実行モードを切り替えることができる仕組みのこと。  

## コンポーネントの自動登録  
「ルートパッケージ」配下のクラスを、命名規則に従ってコンポーネントに登録できる。  
「ルートパッケージ」はconvention.diconで定義する。  
※SMART deployに対応するのはルートパッケージ配下のコンポーネントに限定される。  
自動登録の命名規則を定義したクラスは、creator.diconに列挙されている。  
  
その他の方法としては  
ComponentAutoRegister（いくつか種類がある）クラスをdiconファイルにコンポーネントタグで登録し、  
その記載の中でパッケージ名やJar名、クラス名を正規表現等で指定して、一括で登録する。  
  
## DI  
やり方は3種類ある。  
- diconファイルにコンポーネント（クラス）を記載する  
基本の使い方であり、クラスをコンテナに登録、コンテナから取得できる。  
diconファイルの記載やdiconファイル自体を環境によって切り替えることで、コンテナに登録するクラスを変更できる。  
- 自動バインディングを利用する  
あるコンポーネントに対するDIを、diconファイルに記載せずに行う。  
componentタグのautoBinding属性で、そのコンポーネントにどの程度自動バインディングするかを指定する。（省略されている場合はauto）  
自動バインディングで解決される場合でも、diconファイルに明示的に記載している場合は、そちらが優先される。  
- 外部バインディングを利用する  
HTTPリクエストのパラメーター名と同じプロパティに値が自動的にセットされる。  
これを利用するクラスはdiconファイルにその旨を記載する必要がある。 
  
## S2AOP  
コンテナに登録されているコンポーネントにAOPを適用する仕組みのこと。  
実現には２種類ある。  
#### インターセプター  
いわゆるAOP。  
MethodInterceptorインターフェースを実装したクラスをコンポーネントに登録することで独自のインターセプターを作成できる。  
※Seasar2が用意しいているインターセプターは、aop.diconに用意されている。トランザクション関連はj2ee.diconに用意されている。  
適用方法  
・適用したいコンポーネントのdiconファイルの記載にaspectタグを挿入する。  
・自動登録されたコンポーネントの場合、diconファイルに記載が無いので、アノテーションを付与する。  
  
#### インタータイプ  
通常のAOPではなく、クラスの構造を変更することで実現する。  
InterTypeインターフェースを実装することで独自のインターセプターを作成できる。  
※Seasar2が用意しいているインタータイプもある。  
適用方法  
・適用したいコンポーネントのdiconファイルの記載にinterTypeタグを挿入する。  
・自動登録されたコンポーネントの場合、diconファイルに記載が無いので、アノテーションを付与する。  
  
## AOPの自動登録  
まずはコンポーネントの自動登録で、自作のインターセプターやインタータイプをコンポーネントとして登録しておく。  
AspectAutoRegisterクラスをdiconファイルにコンポーネントタグで登録し、その記載の中でクラスのパターンを正規表現等で指定して  
インターセプターやインタータイプを自動で適用できる。※InterfaceAspectAutoRegisterもある。
