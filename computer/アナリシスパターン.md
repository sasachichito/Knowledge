# アナリシスパターン  
## 導入
モデル化の最大の問題は、モデル化領域に対する開発者の恣意性にある。  
```  
恣意性... 言語が指し示すものと、それを示す言語記号の間には必然的な結びつきはないこと。  
```  
恣意性の排除は、再利用可能なモデリングにおいて最大の関心事になる。  
  
ビジネスの問題領域があり、そこにある概念をもれなく捉え、それらを実装することでソフトウェアが完成するとしたら、  
GoFのデザインパターンは、実装の仕方(実装モデリング)のカタログであり、  
アナリシスパターンは、概念の捉え方(概念モデリング)のカタログである。  
  
概念モデルから実装モデルへの変換には「設計テンプレート」が利用される。  
```
概念モデル
↓
↓ [設計テンプレート]
↓
実装モデル
```
## 型図  
型図... システムの構造的なビュー。  
型... クラスの「インターフェース」。1つの型は多くのクラスによって実装され、1つのクラスは多くの型を実装できる。  
  
型図は概念、仕様、実装の3つの観点から構築される。  
```  
概念モデル... その世界について知っていることを表す。  
仕様モデル... インターフェースを表す。  
（明示的仕様モデル... 良い例はC++のヘッダーファイルで、どんな操作が存在するか、その引数と戻り値を詳細に述べる。）  
（暗示的仕様モデル... 概念モデルに準拠する形でインターフェースを記載したもの。）  
実装モデル... クラス図。  
```  
アナリシスパターン本の型図はほとんどが概念モデル（暗示的仕様モデル）で表記されている。  
つまり関連はデータ構造をそのまま表してはいない（クラス図ではない）ことに注意。  
  
## 知識レベル  
ドメインを表現する概念には存在意義（役割）がある。その概念は「知識レベル」と「操作（業務）レベル」どちらだろうか？  
概念モデルを描くとき、一つの四角形は一つの概念に対応する。  
その四角形は「知識レベル」と「操作レベル」のどちらかに属する。  
  
アナリシスパターンにおいては以下のように言及されている。  
```  
操作レベルのモデルがドメインの日々の出来事を記録するのに対して、知識レベルのモデルはこの構造を支配する一般的ルールを記録する。  
知識レベルという概念を導入することによってその複雑さを管理できる。  
```  
  
エリック・エヴァンスのドメイン駆動設計においては以下のように言及されている。（結局はMartin Fowlerの引用だが）  
```  
知識レベルとは他のオブジェクトがどう振る舞うべきか記述するオブジェクトグループである。  
知識レベルはモデルを構造化する。  
```  
※構造化とは、整理し体系化し、全体の見通しをよくすることだと考えている。  
  
アナリシスパターンの表現が非常にわかりやすいと思う。  
システムのユーザーの操作を記録するのが操作レベルのモデル、ユーザーの操作にルールを与えているのが知識レベルのモデルである。  
ドメイン駆動設計においては、区分オブジェクトや仕様オブジェクトが知識レベルのモデルの実装モデルになる。  
```  
仕様クラス...     
集約のルートにはドメインの振る舞いを扱う責務があるため、    
いくら集約の境界を参照できるとはいえバリデーションの責務を持たせると責務が増えすぎてしまう。    
そのため集約が仕様を満たしているかチェックする仕様クラスを用意し、集約のルートにvalidate()メソッドでそれを利用しチェックさせる。    
これを仕様パターンという。   
```  
仕様パターンとはつまり、操作レベルと知識レベルのモデルを分離することが目的だった。  
