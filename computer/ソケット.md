- ソケット  
プログラム間の接続を実現する仕組みのこと。  
プログラムから見える実体としてはファイルであり、これをソケットと呼ぶ。  
プログラムがソケットを作成する。  
ソケットとソケットを接続すると、そのソケットを持つプログラム同士がインターネットを介しても接続できる。  
【参考】http://www.sbcr.jp/books/img/Linuxnet_02.pdf  
- ソケットAPI  
プログラミングでソケットを操作するときに使うAPIのこと。  
ソケットを作成し   
**accept()** すると、そのソケットは接続待ちとなる。  
**read()** すると、そのソケットの内容を読む。  
**write()** すると、そのソケットに書き込む。書き込んだ内容が接続先ソケットファイルにも書き込まれる。  
- ソケット記述子  
ソケットを一意に示す識別子。  

```
・ファイルディスクリプタ
プロセスがファイル（入出力ストリーム）を特定するための識別子。
ソケットにも付与される。

・ソケット
別のプログラム（ローカル・リモート問わず）とのやりとりに使うファイル。

・ポート
プログラムを特定する番号。ソケットに対して付与される。
カーネルはソケット間通信を実現する。
プログラムAがソケットa、リモートプログラムBがソケットbを持ち、
aとbがコネクションを確立したらソケット間（つまりプログラム間）通信できる。
aに書き込まれた内容は、リモートシステムのbの受信バッファに入る。
その際b側のカーネルはaからのリクエストにあるポート番号でbを特定する。
「ポートを食いつぶす」とは、
ポート番号に限りがあるため、ソケットを作りすぎると枯渇する問題。

・クライアント側目線
ソケット作る
サーバーのソケットとコネクション確立
やり取りする
疑問：ソケットはどのタイミングで破棄される？
プロトコルによる。HTTP1.Xでは
・http keep aliveが無効な場合は
クライアント : ソケット作成
クライアント : コネクションを要求して確立 connect() 
クライアント : ソケットにリクエスト書き込み write() 
クライアント : レスポンス受信開始（リクエストデータを送り終わったとサーバーに通知）
サーバー : ソケットからリクエスト内容読み込み
サーバー : ソケットにレスポンス書き込み
サーバー : 書き込み終わったらコネクション切断
クライアント : ソケット読み込み
クライアント : コネクション切断を検知したら読み込み完了
クライアント : コネクションを持たないソケットをどうするかは実装次第（プーリングなど）
・http keep aliveが有効な場合は
クライアント : ソケット作成
クライアント : コネクションを要求して確立
クライアント : ソケットに全体のデータサイズを先に知らせてリクエスト書き込み（ヘッダーにContent-Lengthをつける）
サーバー : ソケットからリクエスト内容読み込み（ヘッダーとボディは空行で区切られてるのでそれで判断）
サーバー : ソケットに全体のデータサイズを先に知らせてレスポンス書き込み
クライアント : ソケットから指定サイズ読み込みして完了
クライアント : コネクションを保持したソケットをどうするかは実装次第（プーリングなど）

・サーバー側目線
ソケット作る
要求を待つ
クライアントのソケットと繋ぐ
疑問：サーバー側のソケットは1つだけ？
・http keep aliveが無効な場合
省略(下記とkeep alive分の差分しかないため)
・http keep aliveが有効な場合のHTTPを考える
サーバー : リクエストを受け付ける用のソケット作成
サーバー : クライアントからのコネクト要求を待つ accept() 
クライアント : コネクションを要求して確立
サーバー : 要求が来たらコネクションを確立してクライアントとのやりとり用に新たなソケット作成
サーバー : ソケットから指定サイズだけリクエスト読み込み
サーバー : ソケットに全体のデータサイズを先に知らせてレスポンス書き込み

・HTTP2
HTTP1.Xと比較して様々な変更点があるが、ソケットを利用していることは同じ。
HTTP2のストリーミング機能では、1つのコネクションで複数のリクエスト・レスポンスのやり取りを並行実行できる。

・ソケットのバッファ
ソケットには受信バッファと送信バッファがある。
read()は受信バッファから読み込み、write()は送信バッファに書き込む。

・ブロッキング（デフォルト）
connect() accept() : コネクション確立するまでスレッドが待機。
read() : 受信バッファに内容が送られてくるまでスレッドが待機。
write() : 送信バッファに空きがなく書き込めない場合にスレッドが待機。

・ノンブロッキング
connect() accept() : コネクション確立できなければ即時エラーを返す。
read() : 受信バッファに内容がなければ即時エラーを返す。
write() : 送信バッファに空きがなく書き込めない場合に即時エラーを返す。
```
