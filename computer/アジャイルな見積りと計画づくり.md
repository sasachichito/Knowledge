# 用語  
### ソフトウェア開発の問い  
「なにをつくるべきか？」  
計画づくりとはソフトウェア開発の問いに対する適切な答えを探る試みである。  
なにをつくるべきか？を具体的にすると  
「どのくらいの期間で、どれだけのリソースを使って、どのようなフィーチャを備えたプロダクトをつくるべきか？」  
となる。  
  
### 「計画することがすべてだ。立てた計画はどうでもいい。」  
陸軍元帥 ヘルムート・グラフ・フォン・モルトケ  
  
### 不確実性コーン  
スティーブ・マコネルが提唱  
  
### フィーチャ  
ユーザーにとってのソフトウェアの価値を表現したものであり、ユーザーに直接価値を提供するもの。性能目標やセキュリティも含まれる。  
要求仕様・機能要件・大機能・ユースケースとは「ユーザーにとっての」という部分が異なる。  
  
### よい計画づくり  
以下のような特徴を持ったプロセスを指す。  
```  
・リスクを軽減する  
・不確実性を減らす  
・意思決定を支援する  
・信頼を確立する  
・情報を伝達する  
```  
##### リスクを軽減する  
計画づくりにより、プロジェクトのリスクに関する情報が得られる。  
その知見を活かすことでプロジェクトの成功可能性を高められる。  
  
##### 不確実性を減らす  
計画づくりはイテレーティブなものであり、その狙いは新しく得られた知識をその都度取り込みながら、プロダクトのあるべき姿を洗練させていくことである。  
多くのプロジェクトが直面する最大のリスクは、間違ったプロダクトを開発してしまうことだ。  
プロジェクトの失敗条件は「最初に定義した要求よりもいいアイデアを、最後まで誰も思いつかなかったプロジェクト」である。  
最初の計画に入っていたからという理由で何の面白みもないアイデアを採用していては、決してユーザーや顧客に満足してもらえない。  
  
##### 意思決定を支援する  
見積もりと計画があってはじめて、意思決定を下せる。  
組織がスケジュールとコストの見積もりを必要とする理由は2つある。  
```  
1. プロジェクトに実施する価値があるのか判断するため  
2. どちらのプロジェクトを実施するのかを判断するため  
```  
プロジェクトによっては、どういった要員構成が必要かがスケジュールよりも重要になることがある。  
  
##### 信頼を確立する  
約束通りのフィーチャを安定して頻繁に提供し続けることで、開発者と顧客との間に信頼を培うことができる。  
信頼できる見積もりは、信頼できるフィーチャの提供を担保する。  
プロジェクトの早い段階で、顧客が優先順位やトレードオフいとった重要な意思決定を下すためには信頼できる見積もりが必要である。  
  
##### 情報を伝達する  
計画とは期待と可能性を伝達するもので、プロジェクトがたどることになるかもしれない1つの道筋である。  
計画とはリストにあるフィーチャを厳格な期日に正確なコストで提供することを確約するものではなく  
プロジェクトへの期待を共有するための基盤として使うものだ。にもかかわらず計画がリリース期日だけに落とし込まれてしまうことが多く、  
そうするとその日付を導き出すまでの前提や期待がすべて剥ぎ取られてしまう。  
  
### アジャイルな「計画づくり」とは  
「計画づくり(planning)」と「計画(plan)」は区別される。  
計画はドキュメントや図表であり、ある時点でのスナップショットを記録したものだ。  
そこに記録されているのは不確かな未来にプロジェクトで起きるだろうと予測した姿の一つに過ぎない。  
計画づくりは「活動」である。アジャイルな計画づくりで重視するのは計画よりも、計画を作る過程そのものなのだ。  
  
アジャイルな計画づくりでは、プランニングに費やす労力や費用と、プロジェクトの最中に得られる知識とを天秤にかける。  
プロジェクトの途中で新しい知識を得たらそれをもとに計画を見直すのだ。  
「変更されてもかまわない」というだけでなくむしろ「積極的に変更したい」と考えるのがアジャイルな計画である。  
変更そのものに価値があるのではなく、変更が起きることはすなわち何か学習したり過ちに気付いたりしたということなので、  
経済的な影響を踏まえて十分な価値があると判断すれば、計画やスケジュールを変更する。  
  
これらを踏まえると、アジャイルな計画づくりの定義は以下のようになる。  
```  
・計画よりも計画づくりを重視する  
・変化を促進する  
・計画そのものは容易に変更できる。  
・プロジェクト全体にわたって繰り返される  
・  
```  
  
# なぜ計画づくりに失敗するのか  
5つの理由がある  
### 1. フィーチャではなく作業を計画している  
従来の計画策定では作業の完了を基準にしておりフィーチャの提供は重視されていない。  
顧客にとって作業の完了には何の価値もなく、またスケジュールのレビューで足りないフィーチャではなく足りない作業を見つけようとしてしまう。  
作業を基準にした計画はスケジュールから遅延しやすい。  
そうなるとチームは品質を落としたり、あるいは変更管理手順を導入したりする。その変更が極めて高い価値を実現するものであってもだ。  
作業を基準にした計画がスケジュール遅延を招きがちなのは3つの理由がある。  
```  
作業は早く終わらない  
スケジュールの遅れは先へと伝わる  
作業は独立していない  
```  
  
##### 作業は早く終わらない  
パーキンソンの法則「仕事の量は、完成のために与えられた時間をすべて満たすまで膨張する」によるもの。  
つまり5日かかる作業の担当者はたとえ3日で終えそうであっても5日まで作業し続ける。  
  
##### スケジュールの遅れは先へと伝わる  
##### 作業は独立していない  
  
### 2. マルチタスク化が遅れを助長する  
### 3. 優先順位の順にフィーチャを開発していない  
### 4. 不確実性を無視している  
プロダクトに関する不確実性と、構築方法に関する不確実性を無視している。  
```  
プロダクトに関する不確実性の無視... 初期の要求分析において完璧で漏れのない仕様を策定できることを前提にしている  
プロダクト構築方法に関する不確実性の無視... どんな作業なのかはっきりわかっていないのに「10日間」などと高い精度で見積もれることを前提にしている。  
```  
### 5. 見積もりがコミットメントになっている  
そもそも見積もりとは、見積もった時間内に作業が完了する確率のことである。  
つまり「今週中」という見積もりには「今週中に完成する確率は〇％」という意味が含まれている。  
  
コミットメントは確率ではなく日付で表される。  
通常、チームがコミットメントを求められる日付は、その日に作業が完了する確率が100%に満たない日付である。  
チームがそのような日付に対してコミットメントするためには、事前に様々なビジネス上の要素やリスクを検討しておかなければならない。  
  
チームにはそのための機会が与えられるべきであり、いかなる見積もりも暗黙のコミットメントになってはならない。  

# 見積り  
アジャイルな見積りと計画づくりの信条は「	規模を見積もり、期間は導出する」だ。  
規模の見積りには、ストーリーポイントを使った方法と、理想時間を使った方法がある。  
  
## ストーリーポイントによる規模の見積り  
相対的にストーリーポイントで規模を見積もって、ベロシティを測定したら、期間を導出できる。  
  
## 理想日による見積り  
理想時間とは、何かをするのにかかる時間のうち周辺的な作業を時間を差し引いたもの。  
現実時間とは、時計やカレンダー上で経過した時間を指す。  
アメフトの試合時間は理想時間であれば(15分のクォーターが4回で)60分だが、現実時間は4時間ほどである。  
  
ユーザーストーリーを理想時間の日数(理想日)で見積もって、ベロシティを測定したら、期間を導出できる。  
理想「時間」ではなく理想「日」としているのは規模の見積りの段階で時間単位ほど詳細に見積もることは実質不可能(全てのストーリーを細かいタスクに分解して見積もる時間はない)で、意味もあまりないからである。  
## 見積り技法  
### チームで見積もる  
実際にユーザーストーリーを実装する人が見積もりすること。  
また個人ではなくチーム全員で見積もりすることで個人的な知識量や技術力で見積もられることを防ぎ、誰もがそのユーザーストーリーを実装できる環境にする。  
  
### 見積りのスケール  
人は10倍以内のものならうまく見積もれる、という研究結果がある。  
規模の見積りにフィボナッチ数列がおすすめされる理由だ。  
他の数字であっても基準から10倍以内に収まっていれば良い。  
また非常に小さなユーザーストーリーに対して0を付与しても良い。なぜならほぼ0のユーザーストーリーに1を付与してしまうと前回のイテレーションのベロシティが大きく測定されてしまうからだ。  
  
### ユーザーストーリー・エピック・テーマ  
10倍以内に収めるためにはストーリーはかなり細かい単位で書かなければならない。  
しかし必要かどうかまだわからないフィーチャや、近い将来では開発予定にないフィーチャを大きなユーザーストーリーで表現して見積もりだけしておきたい場合がある。  
このような大きなユーザーストーリーをエピックと呼ぶ。  
また関連するユーザーストーリーをまとめて大きなユーザーストーリで表現して見積りやリリースプランニングで使いたい場合がある。  
これをテーマと呼ぶ。エピックはそのままテーマになることもある。  
エピックやテーマは10倍以上の数値で見積もって構わない。(13,21,34,55...)  
  
### プランニングポーカー  
もっともよく使われる見積もり技法は以下の3つだ。  
```  
専門家の意見... 専門家が自分の勘や受けた印象に従って見積もりを出す。  
対比... 相対的に規模を見積もる。  
分割... 1つのストーリーやフィーチャを見積もりやすいように分割して小さくすること。（分割しすぎは見落としを招くため注意）  
```   
プランニングポーカーはこの3つを	組み合わせた方法だ。  
実施タイミングは2種類ある。  
1. プロジェクト開始前か最初のイテレーション  
最初に提示されるユーザーストーリーやテーマを全て見積もるには1〜3時間のミーティングを2〜3回実施することになるかもしれない。  
  
2. イテレーションの途中で新しいストーリーを発見したとき  
各イテレーションの終盤などにごく短い見積もりミーティングの実施をあらかじめ計画に組み込んでおくなどで対処する。  
  
### 再見積もり  
再見積りの目的は、次回のイテレーションに含めるストーリーをベロシティから判断するときに、誤った判断をしないことである。  
  
単に予想よりもベロシティが小さかったというだけでは再見積りはすべきでない。  
なぜなら算出された(思ったより小さな)ベロシティにより、次のイテレーションに含めるストーリーを減らす判断ができることは正しいからである。  
算出されるベロシティを使って期間を再導出すれば動員やリリース日調整の対応が取れる。ベロシティが補正装置と言われる所以である。  
つまりあるストーリーにかかる期間の予想が著しく不正確だったとしても、全てのストーリーの相対的な関係が正しければ再見積りは不要である。  
  
再見積りのタイミングは、ストーリーの相対サイズについての考え方が変わったときだ。  
取り組んだストーリーのうち1つ(Aとする)が見積りよりも大きなポイントであるべきだった場合、  
Aと、Aを基準にして相対的に見積もったストーリー(内容が関連するストーリー,B群とする)についてのみ再見積りで修正する必要がある。  
なぜなら再見積りをしなければ、  
Aの分少しだけ小さく算出されたベロシティを参考に、次回のイテレーションに、  
B群を含めるとイテレーション内に終わらない可能性があり(B群は本当はもっと高ポイントのはずで、多少ベロシティが小さくなったくらいではカバーできない)、  
B群以外のストーリーを含めると途中で終わってしまう(B群以外の実装ベロシティはもっと高いはず)ように間違った判断になるため。  
  
またストーリーの実装途中でイテレーションが終了した場合の、そのイテレーションのベロシティ算出は  
基本的にはオール・オア・ナッシング(ストーリーが全て完了しているなら加算する、そうでないなら加算しない)である。  
なぜなら今回のベロシティが小さくても次回のベロシティが大きくなるため平均で正しいベロシティを算出できるからである。  
もし加算する必要がある場合は、終わらせた分のポイントを見積もり、残りは別のストーリーとして書き直す。  
  
## ストーリーポイントと理想日の比較  
ストーリーポイントは純粋な規模を示し、理想日は理想時間を規模として扱っている。  
純粋な規模とは、抽象的なレベルで、相対的に算出されているという意味である。  
抽象的とは、規模の判断時に詳細な技術に踏み込んでないこと(それができるのは相対的にポイントを決めているから)。つまりスキルとは無関係である。  
理想時間は技術詳細まで考えているケースが多い。なぜなら相対的でない理想日の根拠を考える必要があるから。つまりスキルと関係する。  
  
開発者のスキルがイテレーション毎に熟達していくと、  
ストーリーポイントの場合は、ストーリーポイントは変わらず、ベロシティは向上する。  
理想時間の場合は、理想日が小さくなり、ベロシティは変わらない。  
つまり熟達に合わせて理想日を再見積りする必要がある。  
  
もし理想日を再見積りしなかった場合ベロシティの方が向上するため一見問題ないように思えるが、それは間違いである。  
```  
新たなストーリーの見積もりはプロジェクトの様々なタイミングで行われるため、その度に理想日の判断基準がずれてしまう。  
例えばプロジェクト初期に5理想日と見積もったストーリーと同じ規模・複雑さの新たなストーリーに対して、  
プロジェクト後半の現在では1理想日と見積もるほど熟達したとする。  
つまりイテレーションが1週間だった場合、プロジェクト初期のベロシティは5理想日であったのに、  
現在のベロシティは25理想日にまで向上していることになる。  
ここで初期に見積もったストーリーと後半に見積もったストーリーがプロダクトバックログに混在している場合、  
そこには同じ規模・複雑さのストーリーなのに理想日が5と1のものが混在する。  
現在のベロシティの25理想日は5理想日のストーリーを1イテレーションで消化してきた実績をベースに考えられているので、  
ベロシティから考慮して次回のイテレーションに初期に見積もったストーリー(5理想日)を含める事は問題ないが、  
後半に見積もったストーリー(1理想日)を含めると間違った判断となる。  
後半に見積もったストーリーは実はベロシティ25理想日のうち1理想日ではなく5理想日分を消費するからである。  
```  
従ってストーリーポイントの方が理想日よりも長持ちする。  

# テーマの優先順位づけ  
1つのストーリーのような小さな単位に価値を見出すのは難しい。  
従ってストーリーをまとめてテーマを作り、ビジネス価値に従って優先順位をつける。  
優先順位づけの4つの要素がある。  
```  
1. フィーチャの金銭価値  
2. フィーチャの開発（おそらくはサポートも含む）コスト  
3. フィーチャの開発を通じて学べる知識の量とその意義  
4. フィーチャの開発によって低減できるリスク  
```  
  
# スケジュールを立てる  
リリースプランニングの典型的な手順は以下  
```  
満足条件を決める  
↓  
ユーザーストーリーを見積もる  
↓  
（イテレーションの長さを決める、ベロシティを見積もる、ユーザーストーリーに優先順位をつける）  
↓  
ストーリーを選択し、リリース日を決める  
```  
### 満足条件を決める  
まずプロジェクトの成功と失敗を決める評価条件を把握する。  
ほとんどのプロジェクトで、最終的な評価は金額で決まる。金銭面での目標を達成できそうかどうかを判定するための指標として、  
スケジュール、スコープ、リソースの三種の神器が採用されている。  
  
イテレーションプランニングにはベロシティ駆動とコミットメント駆動のやり方がある。  
  
## ベロシティの見積り  
3つの手法がある。  
```  
・過去の実績値を使う  
・実際に1イテレーションやってみる  
・予想する  
```  
  
### 予想する  
ユーザーストーリーをタスクに分解して、それぞれタスクを見積もり、一回のイテレーションにどれだけのタスクを収められるか考え、そこからベロシティを算出する。  
具体的な手順は以下。  
```  
1. 各メンバーが1日にこなせるプロジェクト作業の時間数を見積もる  
2. メンバーの作業可能時間を合計して、1イテレーションあたりのプロジェクト作業時間を求める  
3. ストーリーの中からいくつか適当に選んで、タスクに分解する。この手順を1回のイテレーションの作業時間の上限に達するまで繰り返す。  
4. 結果として得られたベロシティの見積もりに幅を持たせる。  
```  
  
## 不確実性に備えるバッファの計画  
不確実性や、リリーススケジュールを守れなかった場合にもたらされる損害リスクへの備えとして、スケジュールにバッファを組み込むことが有効である。  
2種類のバッファがある。  
フィーチャバッファとスケジュールバッファだ。  
  
### フィーチャバッファ  
リリース計画に、必須フィーチャと、必須フィーチャの合計ユーザーストーリーポイントの25〜40%分のオプションフィーチャを含める。  
そこからベロシティを測定しリリース計画を立てることで、予定通りであればリリース日直前あたりでは既に必須フィーチャは実装済みでオプションフィーチャに取り組んでいる。  
従って計画が押していたとしても必須フィーチャはリリースできる可能性が高くなる。  
  
### スケジュールバッファ  
50%見積りと90%見積りによる2点見積り法か、50%見積りによる1点見積り法のいずれかによるバッファ計算を行う。  
##### 2点見積り法  
ユーザーストーリーに対して50%見積りと90%見積りの2つを見積もる。  
```  
50%見積り : 順調に進行した場合のストーリーポイント  
90%見積り : 最大限に遅延した場合のストーリーポイント  
```  
(90%見積り - 50%見積り) / 2 = 標準偏差とし、二乗和平方根法により全ストーリーの標準偏差×2を算出する。  
全ストーリーの50%見積り合計にバッファとして標準偏差×2を付与する。  
  
・なぜ標準偏差と二乗和平方根法？  
標準偏差で平均とのばらつきを表現し、二乗和平方根法でばらつきが大きいほど全ストーリーの標準偏差が大きくなるようにする。  
  
・なぜ標準偏差×2？  
「68%95%ルール」というものがあり、「平均±標準偏差」内には68%、「平均±標準偏差×2」内には95%のサンプルが含まれる。  
つまりプロジェクト全体の遅延パターンもできるだけカバーしている。  
  
・90%見積りだけでスケジュールを立てればバッファ不要では？  
全てが最大限に遅延する前提(実際にはほぼあり得ない)なのでスケジュールが長くなりすぎてしまう。  
