# クラス設計の原則  
## 単一責任の原則（SRP : Single Responsibility Principle）  
クラスを変更する理由は1つ以上存在してはならない。  
  
クラスにはシステムの要求仕様に答える役割がある。  
システムの要求仕様には「将来的に変更される仕様」と「変更されない仕様」の2種類がある。  
  
この原則では「役割 ＝ 責任 ＝ 変更理由」と定義しているので  
単一責任とは、2つ以上の「将来的に変更される仕様」に答えてはならないという意味である。  
  
クラスを設計する際には、クラスが2つ以上の「将来的に変更される仕様」に答えていないか確認すること。  
  
## 依存関係逆転の原則（DIP : Dependency Inversion Principle）  
上位のモジュールが下位のモジュールに依存してはならず、どちらも「抽象」に依存すべきである。  
  
アプリケーションの方針を定めている上位モジュールで変更があれば、下位モジュールにも影響が伝達するのが通常である。  
しかし上位のモジュールが下位のモジュールのクラスに依存している（参照を持っている）と、  
下位モジュールで修正があり、そのクラスのシグネチャに変更があったとき上位モジュールを修正しなければならない。  
アプリケーションの方針は変わっていないのに上位モジュールに修正があることは間違っている。  
  
そのため処理の流れは上位モジュール→下位モジュールでも、依存関係は逆転していなければならない。  
上位モジュールは、その中でインターフェースや抽象クラス（まとめて「抽象」とする）を定め、それに依存する。  
下位モジュールは、上位モジュールの「抽象」を実装する。  
  
こうすることで下位モジュールの変更は「抽象」に吸収され、上位モジュールの変更は必要なくなる。  
結果として下位モジュールが上位モジュールの「抽象」に依存している。  
  
「抽象」につける名前は、下位モジュールで幅広く実装されることを想定していることはもちろん、  
上位モジュールでも様々なクラスから依存されることを想定したものにすること。  
  
# パッケージ設計の原則  
## 再利用・リリース等価の原則（REP : Reuse-Rlelease Equivalency Principle）  
再利用の単位（パッケージ）がリリース単位になる。  
  
大前提としてオブジェクト指向における再利用（新しいコードを書くときに既存のクラス・インターフェースを継承・委譲・実装すること）は  
パッケージ単位で行われる。（あるパッケージの中の一つのクラスだけを自分のプロジェクトに持ってきて再利用することはない）  
  
つまりクラスライブラリを作ることはパッケージを作るという意味になる。  
クラスライブラリ（パッケージ）の作者は保守することを期待され、新しいバージョンをリリースするときは  
オプションで古いバージョンを利用できるようにトラッキング（追跡管理）しておかなければならない。  
  
リリースされるパッケージは利用するユーザーの視点に立って構造化（何らかの基準に沿って整理）されていなければならない。  
再利用されるソフトウェアを含むパッケージには、再利用されないソフトウェアは入れてはいけない。  
パッケージは同じ対象者に利用されなければならない。（関係のないソフトウェアが一つのパッケージに含まれてはいけない）  
その他のパッケージ設計原則に従っていなければならない。  
   
## 全再利用の原則（CRP : Common Reuse Principle）  
ユーザーがパッケージを利用する場合、そこに含まれる全てのクラスに依存しなければならない。  
  
あるパッケージの新バージョンがリリースされたとき、たとえパッケージ内の一部のクラスへの変更しかなくても、  
そのパッケージを利用しているパッケージは再評価・再リリースされる必要がある。それが、全く利用していない箇所への変更であっても。  
  
そのため、パッケージを採用する際は、そこに含まれる全てのクラスに依存していなければならないし、  
パッケージを作る際は、利用する側が全てのクラスに依存するように設計しなければならない。  
  
そうすることで必要以上の再評価・再リリースを抑制する。  
  
##   閉鎖性共通の原則（CCP : Common Closure Principle）  
パッケージに関する変更は、そこに含まれる全てクラスに影響するが他のパッケージには全く影響しない。  
  
「単一責任の原則」のパッケージ版であり、同じ理由で変更されるクラスを一つのパッケージにまとめる。  
そうすることで仕様変更時に影響を受けるパッケージ数を最小限に抑え、再評価・再リリースを抑制する。  
  
## 非循環依存関係の原則（ADP : Acycli Dependencies Principle）  
パッケージ依存グラフに循環があってはならない。  
  
ビルド（コンパイル→テスト→リンク）はボトムアップで行われるため、最初は「どこにも依存していないパッケージ」から始まる。  
やがて「依存先パッケージが揃ったパッケージ」が処理されていき、最後に「どこからも依存されていないパッケージ」を処理して完了になる。  
  
あるパッケージが循環依存していると、そのパッケージがいつまで経っても「依存先パッケージが揃ったパッケージ」にならないため、  
ボトムアップで処理できなくなる。  
そのパッケージのテストをする際も「依存先パッケージが揃ったパッケージ」にするために  
循環依存先の全パッケージをコンパイル・リンクしなければならない。  
  
循環を断つために「依存関係逆転の原則」を利用するか、新しいパッケージを作って依存クラスを配置させる。  
  
パッケージ依存グラフはアプリケーションの機能を表現するものではなく、ビルド方法を示すマップである。  
  
  
