# Vim
## Vimは挿入モードに入った瞬間からノーマルモードに戻るまでの間のキーストロークを全て記憶する。  
ドット（.）コマンドでこれを再現できる。  

## オペレータ ＋ モーション ＝ アクション  
オペレータ + オペレータとすると行指向アクションになる。  
(コマンドラインモード以外の)Vimが提供するユーザーインターフェースからはアクション、オペレータ、モーションのどれかを実行できる。  
※コマンドラインモードのVimが提供するのはExコマンド。  

アクションを実行したいとき...  
- ノーマルモードの場合  
アクション入力  
or  
オペレータ入力 → モーション入力  

- ビジュアルモードの場合  
アクション入力  
or  
範囲選択（モーション入力の組み合わせで独自の範囲を設定する） → オペレータ入力  
or  
範囲選択 → アクション入力（元のモーションを変更できる）  

## モード  
ノーマルモード  
オペレータ待機モード  
挿入モード  
挿入ノーマルモード  
置換モード  
ビジュアルモード(文字指向ビジュアルモード、行指向ビジュアルモード、ブロック指向ビジュアルモード)  
選択モード  
コマンドラインモード  

## レジスタには通常のレジスタ(デフォルトレジスタ)とExpressionレジスタがある。  
`"レジスタ名`でアクセスする。  
- 通常レジスタ  
複数ある。  
  - 無名レジスタ    
  `""`でアクセス。  
  - ヤンクレジスタ    
  `"0`でアクセス。  
  - 名前付きレジスタ    
  `"a`〜`"z`でアクセス。  
  - ブラックホールレジスタ  
  `"_`でアクセス。  
  - システムクリップボードレジスタ  
  `"+`でアクセス。  
  - 範囲レジスタ  
  `"*`でアクセス。  
  - その他のレジスタ  
  
- Expressionレジスタ  
`"=`でアクセス。  

`:reg "レジスタ名`で中身を確認できる。


## `：`、`/`、`<C-r>=`を入力するとVimはコマンドラインモードになり、Exコマンドや、！CMDで外部コマンドを実行できる状態となる。

## %記号について  
- Exコマンド  
`{range}`で全行を指定。  

- 外部コマンドの引数  
編集中のファイル名を意味する。  

- モーション  
開きかっこから、対応する閉じかっこにジャンプする

## テキストオブジェクト（モーションの一つ）
ビジュアルモードかオペレータ待機モードで利用でき、２文字で構成される。  
iかaで始まり、後ろにデリミタ（かっこ、タグ）か、ブロック（単語、文、段落）を指定する。
- i  
デリミタorブロックの内側（inside）  
- a  
デリミタorブロックを含む全て（all）  

デリミタで区切られたテキストオブジェクトは、非ブロックオブジェクト、  
ブロックで区切られたテキストオブジェクトは、ブロックオブジェクトと呼ばれる。  

## Vimのマーク
Vimはいくつかのモーション時にその座標に対してマークをつけている。※mコマンドで明示的にマークをつけることもできる。  
`'`や`` ` ``に続けてマークを指定してその座標に移動できる。

## 長距離のモーションはジャンプと呼ばれる

## タグジャンプ
ファイル名や行番号のようなタグ情報を従い、そのファイルを自動的に開いてジャンプすること。  
Vimでもサポートされている。`<C-]>`や`gf`コマンド。  
またジャンプ履歴も保存（マーク）されており、アクセス可能。

- 拡張子を設定する  
`gf`コマンドでファイル名を指定してジャンプする場合、拡張子を付与したい場合がある。  
Exコマンド`:set suffixsadd+=.rb`のように付与。  

- パスを設定する  
ファイル名を指定するコマンド(`gf`や`find`など)では、pathオプション値のディレクトリリストから参照する。  


## Vimのオプション
Vimには動作設定のための内部変数とスイッチがあり、これをオプションという。  
http://vim-jp.org/vimdoc-ja/options.html#options

## vimrcとは  
vimスクリプトである。  
Vim起動時に読み込まれるフック。

## vimスクリプトとは  
Exコマンド、制御構文、Vimに用意されている関数を使って、  
・オプションの設定  
・関数の作成  
・独自コマンドの作成  
ができる。  
~.vimファイル。  
http://vim-jp.org/vimdoc-ja/usr_41.html#script  

#### vimスクリプトのスコープ  
Vimは変数名、関数名の前のプレフィックスをでスコープを判定している。  
  
#### ・変数の場合  
```
g:      グローバル  
b:      現在のバッファにローカル   
w:      現在のウィンドウにローカル   
t:      現在のタブページにローカル   
s:      現在のスクリプトファイルにローカル   
l:      関数ローカル   
v:      組み込み変数   
```
※省略した場合、変数宣言の場所によりスコープが決まる。  
- 関数の中  
ローカルスコープ  
- 関数の外  
グローバルスコープ  
  
#### ・関数の場合  
```
g:      グローバル  
s:      現在のスクリプトファイルにローカル  
```  
※省略した場合、  
グローバルスコープ  
となる。  
  
変数にしかないプレフィックスを付けてもエラーにはならないが、単にそういう名前のグローバルスコープ関数として扱われる。  
  
http://vim-jp.org/vimdoc-ja/map.html#script-local  

スクリプトスコープの関数をmapコマンド経由で呼び出すときは注意が必要となる。  
http://vim-jp.org/vimdoc-ja/usr_41.html#write-plugin の「ピース」の段落に記載してある。  

## vimのプラグインとは
vimスクリプトを書いて配布すれば、それはプラグインとなる。  
プラグインを利用する側は、Vim起動時に動的にvimスクリプトを読み込むためそれをランタイムファイルとも呼ぶ。  

Vimにデフォルトで付属しているプラグイン(ランタイムファイル)もある。  

プラグインには2種類ある。  
- グローバルプラグイン  
全てのバッファに対して適用される。  

- ファイルタイププラグイン  
バッファのfiletypeオプション値に対応した名前であれば適用される。  

http://vim-jp.org/vimdoc-ja/usr_41.html#write-plugin  

## runtimepathとは
ランタイムファイルを読み込むパス。  
用途・目的によりランタイムファイルの配置場所が異なるので、runtimepathも複数ある。  
http://vim-jp.org/vimdoc-ja/options.html#'runtimepath'

## Vimパッケージとは
一つ以上のプラグインを含むディレクトリ。  
http://vim-jp.org/vimdoc-ja/repeat.html#packages

## プラグインを追加する
プラグインの種類（グローバル or ファイルタイプ）や、Vimパッケージかどうかで配置場所が異なるが、  
基本的にはプラグイン（ランタイムファイル(~.vim)とその他設定ファイル）をダウンロードして  
runtimepathの通っているディレクトリに配置するだけで良い。  
http://vim-jp.org/vimdoc-ja/usr_05.html#add-plugin

## ctagsとは
ファイルを指定して実行すると、そのインデックスを作成するソフトウェア。  
作成されたインデックスファイルをタグファイルと呼ぶ。  
Vimではctagsと連携してインデックスを利用し、補完やジャンプを行う。  

Vimのtagsオプションでどのタグファイルを検索するか決定している。  

## Vimのmakeコマンド
Exコマンド。  
外部プログラムを実行し、そのエラーメッセージをパースしてquikfixリストに保存してくれる。  
デフォルトでは`$ make`(C言語のコンパイル)が実行される。  

実行する外部プログラムはmakeprgオプションで指定できる。  
`$ make`以外のコマンドでquikfixリストを利用したい場合は、エラーメッセージを編集してVimがパースできる形にするか、  
errorformatオプションを編集してパース方法を変更する必要がある。  
※コンパイラプラグインというプラグインを利用すれば、自動でmakeprgオプションとerrorformatオプションを設定できる。  


## Vimのgrepコマンド
Exコマンド。  
デフォルトで外部プログラムgrepのラッパーを実行する。  
実行する外部プログラムをgrepprgで、出力のパース方法をgrepformatで設定できる。  
結果はquikfixリストに保存される。  

## Vimのvimgrepコマンド
Exコマンド。  
Vimの検索条件書式が利用できる他、利点があるよう。  

## Vimの自動補完
自動補完の仕組みは、関連ファイル群から単語リストを作成し、入力値でフィルタすることで実現している。  
何を関連ファイルとするかで単語リストが変わる。  
関連ファイルの定義は４つある。  

- バッファリスト  
現在のVimセッションでオープンされた全ファイルから単語リストを作成する。  
**バッファキーワード** と呼ぶ。

- インクルードファイル  
インクルードされる全ファイルから単語リストを作成する。  
プログラミング言語によりインクルードの記載方法が異なるので、Vimが理解できるようにincludeオプションを設定する。  
※プラグインで設定できる。  
**インクルードキーワード** と呼ぶ。  

- タグファイル  
ctags等で作成したインデックスファイルから単語リストを作成する。  
**タグキーワード** と呼ぶ。  

- スペル辞書  
vimが持つスペル辞書から単語リストを作成する。  
spellオプションが有効の場合、スペルチェッカとしても利用できる。  
spellオプションが無効の場合でも、dictionaryオプションで設定すれば単語リストとしては利用できる。  
**辞書キーワード** と呼ぶ。  

バッファ、インクルード、タグキーワードを合わせて  
**汎用キーワード** と呼ぶ。  

補完でどのキーワードを利用するか選べるようになっている。  

また、オムニ補完と呼ばれる、キーワードではなく関数を使って補完内容を推測する方法もある。  
※各プログラミング言語にオムニ補完用プラグインが用意されている。  

## スペルチェッカ  
Vimはデフォルトでスペル辞書（英単語）を持っており、spellオプションを有効化することでスペルのチェックを行うことができる。  
スペル辞書は追加、追記できる。  

# PHP用にVimをカスタマイズする  
## TODOを列挙する
- シンタックスハイライトをPHP用にする
- インデント幅をPHP用にする
- 補完・ジャンプをPHP用にする
  - タグファイルの設定
  - インクルードの設定
  - オムニ補完の設定
  - スペル辞書の設定
- スペルチェッカをPHP用にする
- makeコマンドをPHP用にする

